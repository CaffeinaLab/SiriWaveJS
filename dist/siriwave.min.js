!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SiriWave=e()}(this,function(){"use strict";function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var y=function(){function e(t){v(this,e),this.ctrl=t.ctrl,this.definition=t.definition,this.ATT_FACTOR=4}return t(e,[{key:"_globalAttFn",value:function(t){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(t,this.ATT_FACTOR)),this.ATT_FACTOR)}},{key:"_xpos",value:function(t){return this.ctrl.width/2+t*(this.ctrl.width/4)}},{key:"_ypos",value:function(t){return this.ctrl.heightMax+this._globalAttFn(t)*(this.ctrl.heightMax*this.ctrl.amplitude/this.definition.attenuation)*Math.sin(this.ctrl.opt.frequency*t-this.ctrl.phase)}},{key:"draw",value:function(){var t=this.ctrl.ctx;t.moveTo(0,0),t.beginPath(),t.strokeStyle="rgba("+this.ctrl.color+","+this.definition.opacity+")",t.lineWidth=this.definition.lineWidth;for(var e=-this.ctrl.MAX_X;e<=this.ctrl.MAX_X;e+=this.ctrl.opt.pixelDepth)t.lineTo(this._xpos(e),this._ypos(e));t.stroke()}}],[{key:"getDefinition",value:function(){return[{attenuation:-2,lineWidth:1,opacity:.1},{attenuation:-6,lineWidth:1,opacity:.2},{attenuation:4,lineWidth:1,opacity:.4},{attenuation:2,lineWidth:1,opacity:.6},{attenuation:1,lineWidth:1.5,opacity:1}]}}]),e}(),w=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};v(this,e),this.ctrl=t.ctrl,this.definition=t.definition,this.phase=0,this.AMPLITUDE_RANGE=[.1,1],this.WIDTH_RANGE=[.1,.3],this._respawn()}return t(e,[{key:"_respawn",value:function(){this.seed=Math.random(),this.amplitude=this.AMPLITUDE_RANGE[0]+Math.random()*(this.AMPLITUDE_RANGE[1]-this.AMPLITUDE_RANGE[0]),this.width=this.ctrl.width*(this.WIDTH_RANGE[0]+Math.random()*(this.WIDTH_RANGE[1]-this.WIDTH_RANGE[0])),this.openClass=2+(3*Math.random()|0)}},{key:"_ypos",value:function(t){var e=1*Math.abs(Math.sin(this.phase))*this.ctrl.amplitude*this.amplitude*this.ctrl.heightMax*Math.pow(1/(1+Math.pow(this.openClass*t,2)),2);return Math.abs(e)<this.ctrl.DEAD_THRESHOLD&&this._respawn(),e}},{key:"draw",value:function(){this.phase+=this.ctrl.speed*(1-.5*Math.sin(this.seed*Math.PI));for(var t,e,i=2*this.width+(-this.width+this.seed*(2*this.width)),n=this.ctrl.heightMax,r=Math.abs(this._ypos(0)),o=i+-this.ctrl.MAX_X*this.width,s=this.ctrl.ctx,a=[-1,1],h=0;h<a.length;h++){var l=a[h];s.beginPath();for(var c=-this.ctrl.MAX_X;c<=this.ctrl.MAX_X;c+=this.ctrl.opt.pixelDepth)t=i+c*this.width,e=n+l*this._ypos(c),s.lineTo(t,e);var u=s.createRadialGradient(i,n,1.15*r,i,n,.3*r);u.addColorStop(0,"rgba("+this.definition.color+", 0.8)"),u.addColorStop(1,"rgba("+this.definition.color+", 0.2)"),s.fillStyle=u,s.lineTo(o,n),s.closePath(),s.fill()}}}],[{key:"getDefinition",value:function(){return[{color:"32,133,252"},{color:"94,252,169"},{color:"253,71,103"}]}}]),e}(),e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};for(var i,r=(function(s){(function(){var t,e,i,n,r,o;"undefined"!=typeof performance&&null!==performance&&performance.now?s.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(s.exports=function(){return(t()-r)/1e6},e=process.hrtime,n=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),o=1e9*process.uptime(),r=n-o):i=Date.now?(s.exports=function(){return Date.now()-i},Date.now()):(s.exports=function(){return(new Date).getTime()-i},(new Date).getTime())}).call(e)}(i={exports:{}},i.exports),i.exports),o="undefined"==typeof window?e:window,s=["moz","webkit"],a="AnimationFrame",h=o["request"+a],l=o["cancel"+a]||o["cancelRequest"+a],c=0;!h&&c<s.length;c++)h=o[s[c]+"Request"+a],l=o[s[c]+"Cancel"+a]||o[s[c]+"CancelRequest"+a];if(!h||!l){var u=0,p=0,d=[];h=function(t){if(0===d.length){var e=r(),i=Math.max(0,1e3/60-(e-u));u=i+e,setTimeout(function(){for(var t=d.slice(0),e=d.length=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(u)}catch(t){setTimeout(function(){throw t},0)}},Math.round(i))}return d.push({handle:++p,callback:t,cancelled:!1}),p},l=function(t){for(var e=0;e<d.length;e++)d[e].handle===t&&(d[e].cancelled=!0)}}var m=function(t){return h.call(o,t)};m.cancel=function(){l.apply(o,arguments)},m.polyfill=function(t){t||(t=o),t.requestAnimationFrame=h,t.cancelAnimationFrame=l};var g=function(t,e,i){return t*(1-i)+e*i};return function(){function f(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,f),this.container=t.container||document.body,this.opt=Object.assign({style:"ios",ratio:window.devicePixelRatio||1,speed:.1,amplitude:1,frequency:6,color:"#fff",speedInterpolationSpeed:.05,amplitudeInterpolationSpeed:.005,cover:!1,width:window.getComputedStyle(this.container).width.replace("px",""),height:window.getComputedStyle(this.container).height.replace("px",""),autostart:!1,pixelDepth:.02,lerpSpeed:.01},t),this.MAX_X=2,this.DEAD_THRESHOLD=.05,this.phase=0,this.run=!1,this.speed=Number(this.opt.speed),this.amplitude=Number(this.opt.amplitude),this.width=Number(this.opt.ratio*this.opt.width),this.height=Number(this.opt.ratio*this.opt.height),this.heightMax=Number(this.height/2)-6,this.color=this._hex2rgb(this.opt.color),this.interpolation={speed:this.speed,amplitude:this.amplitude},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,!0===this.opt.cover?this.canvas.style.width=this.canvas.style.height="100%":(this.canvas.style.width=this.width/this.opt.ratio+"px",this.canvas.style.height=this.height/this.opt.ratio+"px"),this.curves=[],"ios9"===this.opt.style){var e=!0,i=!1,n=void 0;try{for(var r,o=w.getDefinition()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)for(var s=r.value,a=0;a<2;a++)this.curves.push(new w({ctrl:this,definition:s}))}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}else{var h=!0,l=!1,c=void 0;try{for(var u,p=y.getDefinition()[Symbol.iterator]();!(h=(u=p.next()).done);h=!0){var d=u.value;this.curves.push(new y({ctrl:this,definition:d}))}}catch(t){l=!0,c=t}finally{try{h||null==p.return||p.return()}finally{if(l)throw c}}}this.container.appendChild(this.canvas),t.autostart&&this.start()}return t(f,[{key:"_hex2rgb",value:function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?parseInt(e[1],16).toString()+","+parseInt(e[2],16).toString()+","+parseInt(e[3],16).toString():null}},{key:"_lerp",value:function(t){return this[t]=g(this[t],this.interpolation[t],this.opt.lerpSpeed),this[t]}},{key:"_clear",value:function(){this.ctx.globalCompositeOperation="destination-out",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="source-over"}},{key:"_draw",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.curves[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.draw()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"_startDrawCycle",value:function(){!1!==this.run&&(this._clear(),this._lerp("amplitude"),this._lerp("speed"),this._draw(),this.phase=(this.phase+Math.PI*this.speed)%(2*Math.PI),m(this._startDrawCycle.bind(this)))}},{key:"start",value:function(){this.phase=0,this.run=!0,this._startDrawCycle()}},{key:"stop",value:function(){this.phase=0,this.run=!1}},{key:"set",value:function(t,e){this.interpolation[t]=Number(e)}},{key:"setSpeed",value:function(t){this.set("speed",t)}},{key:"setAmplitude",value:function(t){this.set("amplitude",t)}}]),f}()});
